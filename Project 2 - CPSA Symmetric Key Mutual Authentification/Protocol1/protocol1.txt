(herald "Protocol1")

(comment "CPSA 4.4.2")
(comment "All input read from protocol1.scm")

(defprotocol protocol1 basic
  (defrole authserv
    (vars (a b as name) (nonceA text) (session_key skey))
    (trace (recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    (uniq-orig session_key))
  (defrole server
    (vars (a b as name) (nonceB text) (session_key skey))
    (trace (recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key))))
  (defrole client
    (vars (a b as name) (nonceA nonceB text) (tkt_as mesg)
      (session_key skey))
    (trace (send (cat a b nonceA))
      (recv (enc nonceA b session_key tkt_as (ltk a as))) (send tkt_as)
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false)))))

(defskeleton protocol1
  (vars (session_key skey) (nonceB text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig nonceB)
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key))))
  (label 0)
  (unrealized (0 0))
  (origs (nonceB (0 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (precedes ((1 1) (0 0)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation encryption-test (added-strand authserv 2)
    (enc session_key a (ltk b as)) (0 0))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as)))))
  (label 1)
  (parent 0)
  (unrealized (0 0) (0 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (precedes ((1 1) (2 1)) ((2 2) (0 0)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation encryption-test (added-strand client 3)
    (enc session_key a (ltk b as)) (0 0)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))))
  (label 2)
  (parent 1)
  (unrealized (0 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (precedes ((0 1) (2 3)) ((1 1) (2 1)) ((2 2) (0 0)) ((2 4) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation encryption-test (displaced 2 3 client 5)
    (enc (hash nonceB) session_key) (0 2))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 3)
  (parent 2)
  (realized)
  (shape)
  (maps
    ((0)
      ((a a) (b b) (as as) (nonceB nonceB) (session_key session_key))))
  (origs (session_key (1 1)) (nonceB (0 1))))

(defskeleton protocol1
  (vars (tkt_as mesg) (session_key skey) (nonceB nonceA nonceA-0 text)
    (a b as a-0 b-0 as-0 name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as tkt_as) (session_key session_key)
    (nonceA nonceA-0) (nonceB nonceB) (a a-0) (b b-0) (as as-0))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((1 1) (3 1)) ((2 2) (0 0))
    ((3 4) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation encryption-test (added-strand client 5)
    (enc (hash nonceB) session_key) (0 2))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a-0 b-0 nonceA-0))
      (recv (enc nonceA-0 b-0 session_key tkt_as (ltk a-0 as-0)))
      (send tkt_as) (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 4)
  (parent 2)
  (unrealized (3 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (deflistener session_key)
  (precedes ((1 1) (2 1)) ((1 1) (3 0)) ((2 2) (0 0)) ((3 1) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation encryption-test (added-listener session_key)
    (enc (hash nonceB) session_key) (0 2))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((recv session_key) (send session_key)))
  (label 5)
  (parent 2)
  (unrealized (3 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((1 1) (3 1)) ((2 2) (0 0))
    ((3 4) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test
    (contracted (a-0 a) (b-0 b) (as-0 as) (nonceA-0 nonceA)
      (tkt_as (enc session_key a (ltk b as)))) session_key (3 1)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 6)
  (parent 4)
  (realized)
  (shape)
  (maps
    ((0)
      ((a a) (b b) (as as) (nonceB nonceB) (session_key session_key))))
  (origs (session_key (1 1)) (nonceB (0 1))))

(defskeleton protocol1
  (vars (tkt_as mesg) (session_key skey) (nonceB nonceA nonceA-0 text)
    (a b as a-0 b-0 as-0 name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as tkt_as) (session_key session_key)
    (nonceA nonceA-0) (nonceB nonceB) (a a-0) (b b-0) (as as-0))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((2 2) (0 0)) ((2 2) (3 1))
    ((3 4) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test (displaced 4 2 client 3) session_key (3 1)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a-0 b-0 nonceA-0))
      (recv (enc nonceA-0 b-0 session_key tkt_as (ltk a-0 as-0)))
      (send tkt_as) (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 7)
  (parent 4)
  (unrealized (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (tkt_as mesg) (session_key skey) (nonceB nonceA nonceA-0 text)
    (a b as a-0 b-0 as-0 name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as tkt_as) (session_key session_key)
    (nonceA nonceA-0) (nonceB nonceB) (a a-0) (b b-0) (as as-0))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((1 1) (4 1)) ((2 2) (0 0))
    ((3 4) (0 2)) ((4 2) (3 1)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test (added-strand client 3) session_key (3 1)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a-0 b-0 nonceA-0))
      (recv (enc nonceA-0 b-0 session_key tkt_as (ltk a-0 as-0)))
      (send tkt_as) (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))))
  (label 8)
  (parent 4)
  (unrealized (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (deflistener session_key)
  (precedes ((1 1) (2 1)) ((2 2) (0 0)) ((2 2) (3 0)) ((3 1) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test (displaced 4 2 client 3) session_key (3 0)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((recv session_key) (send session_key)))
  (label 9)
  (parent 5)
  (unrealized (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (deflistener session_key)
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (precedes ((1 1) (2 1)) ((1 1) (4 1)) ((2 2) (0 0)) ((3 1) (0 2))
    ((4 2) (3 0)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test (added-strand client 3) session_key (3 0)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((recv session_key) (send session_key))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))))
  (label 10)
  (parent 5)
  (unrealized (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((2 2) (0 0)) ((2 2) (3 1))
    ((3 4) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test
    (contracted (a-0 a) (b-0 b) (as-0 as) (nonceA-0 nonceA)
      (tkt_as (enc session_key a (ltk b as)))) session_key (3 1)
    (enc session_key a (ltk b as))
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 11)
  (parent 7)
  (realized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((1 1) (4 1)) ((2 2) (0 0))
    ((3 4) (0 2)) ((4 2) (3 1)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation nonce-test
    (contracted (a-0 a) (b-0 b) (as-0 as) (nonceA-0 nonceA)
      (tkt_as (enc session_key a (ltk b as)))) session_key (3 1)
    (enc session_key a (ltk b as))
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))))
  (label 12)
  (parent 8)
  (seen 6)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceB nonceA text) (a b as name))
  (defstrand server 3 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand client 3 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (a a) (b b) (as as))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (precedes ((0 1) (3 3)) ((1 1) (2 1)) ((1 1) (3 1)) ((2 0) (3 1))
    ((2 2) (0 0)) ((3 4) (0 2)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceB)
  (operation generalization weakened ((2 2) (3 1)))
  (traces
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as))))
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 13)
  (parent 11)
  (seen 6)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(comment "Nothing left to do")

(defprotocol protocol1 basic
  (defrole authserv
    (vars (a b as name) (nonceA text) (session_key skey))
    (trace (recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    (uniq-orig session_key))
  (defrole server
    (vars (a b as name) (nonceB text) (session_key skey))
    (trace (recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))
      (recv (enc (hash nonceB) session_key))))
  (defrole client
    (vars (a b as name) (nonceA nonceB text) (tkt_as mesg)
      (session_key skey))
    (trace (send (cat a b nonceA))
      (recv (enc nonceA b session_key tkt_as (ltk a as))) (send tkt_as)
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false)))))

(defskeleton protocol1
  (vars (tkt_as mesg) (session_key skey) (nonceA nonceB text)
    (a b as name))
  (defstrand client 5 (tkt_as tkt_as) (session_key session_key)
    (nonceA nonceA) (nonceB nonceB) (a a) (b b) (as as))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig nonceA)
  (traces
    ((send (cat a b nonceA))
      (recv (enc nonceA b session_key tkt_as (ltk a as))) (send tkt_as)
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key))))
  (label 14)
  (unrealized (0 1))
  (origs (nonceA (0 0)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceA nonceB text) (a b as name))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (precedes ((0 0) (1 0)) ((1 1) (0 1)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceA)
  (operation encryption-test (added-strand authserv 2)
    (enc nonceA b session_key (enc session_key a (ltk b as)) (ltk a as))
    (0 1))
  (traces
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as)))))
  (label 15)
  (parent 14)
  (unrealized (0 3))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceA nonceB text)
    (a b as a-0 b-0 as-0 name))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand server 2 (session_key session_key) (nonceB nonceB) (a a-0)
    (b b-0) (as as-0))
  (precedes ((0 0) (1 0)) ((1 1) (0 1)) ((1 1) (2 0)) ((2 1) (0 3)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceA)
  (operation encryption-test (added-strand server 2)
    (enc nonceB session_key) (0 3))
  (traces
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((recv (enc session_key a-0 (ltk b-0 as-0)))
      (send (enc nonceB session_key))))
  (label 16)
  (parent 15)
  (unrealized (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceA nonceB text) (a b as name))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (deflistener session_key)
  (precedes ((0 0) (1 0)) ((1 1) (0 1)) ((1 1) (2 0)) ((2 1) (0 3)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceA)
  (operation encryption-test (added-listener session_key)
    (enc nonceB session_key) (0 3))
  (traces
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as)))) ((recv session_key) (send session_key)))
  (label 17)
  (parent 15)
  (unrealized (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceA nonceB text)
    (a b as a-0 b-0 as-0 name))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand server 2 (session_key session_key) (nonceB nonceB) (a a-0)
    (b b-0) (as as-0))
  (precedes ((0 0) (1 0)) ((0 2) (2 0)) ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceA)
  (operation nonce-test (displaced 3 0 client 3) session_key (2 0)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((recv (enc session_key a-0 (ltk b-0 as-0)))
      (send (enc nonceB session_key))))
  (label 18)
  (parent 16)
  (unrealized (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton protocol1
  (vars (session_key skey) (nonceA nonceB text) (a b as name))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (deflistener session_key)
  (precedes ((0 0) (1 0)) ((0 2) (2 0)) ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceA)
  (operation nonce-test (displaced 3 0 client 3) session_key (2 0)
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as)))) ((recv session_key) (send session_key)))
  (label 19)
  (parent 17)
  (unrealized (2 0))
  (dead)
  (comment "empty cohort"))

(defskeleton protocol1
  (vars (session_key skey) (nonceA nonceB text) (a b as name))
  (defstrand client 5 (tkt_as (enc session_key a (ltk b as)))
    (session_key session_key) (nonceA nonceA) (nonceB nonceB) (a a)
    (b b) (as as))
  (defstrand authserv 2 (session_key session_key) (nonceA nonceA) (a a)
    (b b) (as as))
  (defstrand server 2 (session_key session_key) (nonceB nonceB) (a a)
    (b b) (as as))
  (precedes ((0 0) (1 0)) ((0 2) (2 0)) ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig (ltk a as) (ltk b as))
  (uniq-orig session_key nonceA)
  (operation nonce-test (contracted (a-0 a) (b-0 b) (as-0 as))
    session_key (2 0) (enc session_key a (ltk b as))
    (enc nonceA b session_key (enc session_key a (ltk b as))
      (ltk a as)))
  (traces
    ((send (cat a b nonceA))
      (recv
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))) (send (enc session_key a (ltk b as)))
      (recv (enc nonceB session_key))
      (send (enc (hash nonceB) session_key)))
    ((recv (cat a b nonceA))
      (send
        (enc nonceA b session_key (enc session_key a (ltk b as))
          (ltk a as))))
    ((recv (enc session_key a (ltk b as)))
      (send (enc nonceB session_key))))
  (label 20)
  (parent 18)
  (realized)
  (shape)
  (maps
    ((0)
      ((a a) (b b) (as as) (nonceA nonceA) (nonceB nonceB)
        (tkt_as (enc session_key a (ltk b as)))
        (session_key session_key))))
  (origs (session_key (1 1)) (nonceA (0 0))))

(comment "Nothing left to do")
