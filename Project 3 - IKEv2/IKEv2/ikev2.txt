(herald "IKEv2")

(comment "CPSA 4.4.2")
(comment "All input read from ikev2.scm")

(defprotocol ikev2 basic
  (defrole initiator
    (vars (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr data)
      (initiator responder certificateAuthority name)
      (NonceInit NonceRecv text))
    (trace (send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder)))))))
  (defrole responder
    (vars (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr data)
      (initiator responder certificateAuthority name)
      (NonceInit NonceRecv text))
    (trace (recv (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (send
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (recv
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit responder) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (send
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit responder) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder)))))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false)))))

(defskeleton ikev2
  (vars (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr data)
    (NonceInit NonceRecv text)
    (initiator responder certificateAuthority name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder)))))))
  (label 0)
  (unrealized (0 3))
  (origs (NonceInit (0 0)))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr data)
    (NonceInit NonceRecv text) (initiator certificateAuthority name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder initiator)
    (certificateAuthority certificateAuthority))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 1 0 initiator 3)
    (enc (hash responder (pubk responder)) (privk certificateAuthority))
    (0 3))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk initiator) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            initiator (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk initiator)))))))
  (label 1)
  (parent 0)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder initiator)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 TSi-0 TSr-0 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 text)
    (initiator responder certificateAuthority responder-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator responder) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 2) (0 3)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash responder (pubk responder)) (privk certificateAuthority))
    (0 3))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((send (cat IKEheader-0 SAi1-0 (pubk responder) NonceInit-0))
      (recv
        (cat IKEheader-0 SAr1-0 (pubk responder-0) NonceRecv-0
          certificateAuthority))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder-0)
              (pubk responder)))))))
  (label 2)
  (parent 0)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 text)
    (initiator responder certificateAuthority initiator-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash responder (pubk responder)) (privk certificateAuthority))
    (0 3))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder)))))))
  (label 3)
  (parent 0)
  (unrealized (1 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 text)
    (initiator responder certificateAuthority name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (precedes ((0 2) (1 2)) ((1 3) (0 3)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 2 0 initiator 3)
    (enc (hash initiator-0 (pubk initiator-0))
      (privk certificateAuthority)) (1 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator)
              (pubk responder)))))))
  (label 4)
  (parent 3)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 TSi-1
      TSr-1 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      text)
    (initiator responder certificateAuthority initiator-0 responder-0
      name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-0) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 2) (1 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash initiator-0 (pubk initiator-0))
      (privk certificateAuthority)) (1 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((send (cat IKEheader-1 SAi1-1 (pubk initiator-0) NonceInit-1))
      (recv
        (cat IKEheader-1 SAr1-1 (pubk responder-0) NonceRecv-1
          certificateAuthority))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk responder-0)
              (pubk initiator-0)))))))
  (label 5)
  (parent 3)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash initiator-0 (pubk initiator-0))
      (privk certificateAuthority)) (1 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0)))))))
  (label 6)
  (parent 3)
  (unrealized (2 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      text) (initiator responder certificateAuthority initiator-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (precedes ((0 2) (2 2)) ((1 3) (0 3)) ((2 3) (1 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 3 0 initiator 3)
    (enc (hash initiator-1 (pubk initiator-1))
      (privk certificateAuthority)) (2 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator)
              (pubk initiator-0)))))))
  (label 7)
  (parent 6)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 TSi-2 TSr-2 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      responder-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-1) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 2) (2 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash initiator-1 (pubk initiator-1))
      (privk certificateAuthority)) (2 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((send (cat IKEheader-2 SAi1-2 (pubk initiator-1) NonceInit-2))
      (recv
        (cat IKEheader-2 SAr1-2 (pubk responder-0) NonceRecv-2
          certificateAuthority))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk responder-0)
              (pubk initiator-1)))))))
  (label 8)
  (parent 6)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash initiator-1 (pubk initiator-1))
      (privk certificateAuthority)) (2 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1)))))))
  (label 9)
  (parent 6)
  (unrealized (3 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (precedes ((0 2) (3 2)) ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 4 0 initiator 3)
    (enc (hash initiator-2 (pubk initiator-2))
      (privk certificateAuthority)) (3 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator)
              (pubk initiator-1)))))))
  (label 10)
  (parent 9)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 TSi-3 TSr-3 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 responder-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-2) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 2) (3 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash initiator-2 (pubk initiator-2))
      (privk certificateAuthority)) (3 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((send (cat IKEheader-3 SAi1-3 (pubk initiator-2) NonceInit-3))
      (recv
        (cat IKEheader-3 SAr1-3 (pubk responder-0) NonceRecv-3
          certificateAuthority))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk responder-0)
              (pubk initiator-2)))))))
  (label 11)
  (parent 9)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash initiator-2 (pubk initiator-2))
      (privk certificateAuthority)) (3 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2)))))))
  (label 12)
  (parent 9)
  (unrealized (4 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (precedes ((0 2) (4 2)) ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2))
    ((4 3) (3 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 5 0 initiator 3)
    (enc (hash initiator-3 (pubk initiator-3))
      (privk certificateAuthority)) (4 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator)
              (pubk initiator-2)))))))
  (label 13)
  (parent 12)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 TSi-4 TSr-4 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 responder-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-3) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2))
    ((5 2) (4 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash initiator-3 (pubk initiator-3))
      (privk certificateAuthority)) (4 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((send (cat IKEheader-4 SAi1-4 (pubk initiator-3) NonceInit-4))
      (recv
        (cat IKEheader-4 SAr1-4 (pubk responder-0) NonceRecv-4
          certificateAuthority))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk responder-0)
              (pubk initiator-3)))))))
  (label 14)
  (parent 12)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 initiator-4 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-4) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2))
    ((5 3) (4 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash initiator-3 (pubk initiator-3))
      (privk certificateAuthority)) (4 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator-4) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator-4)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-4)
              (pubk initiator-3)))))))
  (label 15)
  (parent 12)
  (unrealized (5 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (precedes ((0 2) (5 2)) ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2))
    ((4 3) (3 2)) ((5 3) (4 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 6 0 initiator 3)
    (enc (hash initiator-4 (pubk initiator-4))
      (privk certificateAuthority)) (5 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator)
              (pubk initiator-3)))))))
  (label 16)
  (parent 15)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 IKEheader-5 SAi1-5 SAr1-5
      SAi2-5 TSi-5 TSr-5 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 NonceInit-5 NonceRecv-5 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 initiator-4 responder-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-4) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-5) (SAi1 SAi1-5)
    (SAr1 SAr1-5) (SAi2 SAi2-5) (TSi TSi-5) (TSr TSr-5)
    (NonceInit NonceInit-5) (NonceRecv NonceRecv-5)
    (initiator initiator-4) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2))
    ((5 3) (4 2)) ((6 2) (5 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash initiator-4 (pubk initiator-4))
      (privk certificateAuthority)) (5 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator-4) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator-4)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-4)
              (pubk initiator-3))))))
    ((send (cat IKEheader-5 SAi1-5 (pubk initiator-4) NonceInit-5))
      (recv
        (cat IKEheader-5 SAr1-5 (pubk responder-0) NonceRecv-5
          certificateAuthority))
      (send
        (cat IKEheader-5
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-5 initiator-4) SAi2-5 TSi-5
            TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk responder-0)
              (pubk initiator-4)))))))
  (label 17)
  (parent 15)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 IKEheader-5 SAi1-5 SAr1-5
      SAi2-5 SAr2-5 TSi-5 TSr-5 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 NonceInit-5 NonceRecv-5 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 initiator-4 initiator-5 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-4) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-5) (SAi1 SAi1-5)
    (SAr1 SAr1-5) (SAi2 SAi2-5) (SAr2 SAr2-5) (TSi TSi-5) (TSr TSr-5)
    (NonceInit NonceInit-5) (NonceRecv NonceRecv-5)
    (initiator initiator-5) (responder initiator-4)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2))
    ((5 3) (4 2)) ((6 3) (5 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash initiator-4 (pubk initiator-4))
      (privk certificateAuthority)) (5 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator-4) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator-4)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-4)
              (pubk initiator-3))))))
    ((recv (cat IKEheader-5 SAi1-5 (pubk initiator-5) NonceInit-5))
      (send
        (cat IKEheader-5 SAr1-5 (pubk initiator-4) NonceRecv-5
          certificateAuthority))
      (recv
        (cat IKEheader-5
          (enc initiator-5
            (cat initiator-5 (pubk initiator-5)
              (enc (hash initiator-5 (pubk initiator-5))
                (privk certificateAuthority))) certificateAuthority
            initiator-4 (hash NonceInit-5 initiator-4) SAi2-5 TSi-5
            TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-4)
              (pubk initiator-5)))))
      (send
        (cat IKEheader-5
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority)))
            (hash NonceInit-5 initiator-4) SAr2-5 TSi-5 TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-5)
              (pubk initiator-4)))))))
  (label 18)
  (parent 15)
  (unrealized (6 2))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 IKEheader-5 SAi1-5 SAr1-5
      SAi2-5 SAr2-5 TSi-5 TSr-5 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 NonceInit-5 NonceRecv-5 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 initiator-4 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-4) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-5) (SAi1 SAi1-5)
    (SAr1 SAr1-5) (SAi2 SAi2-5) (SAr2 SAr2-5) (TSi TSi-5) (TSr TSr-5)
    (NonceInit NonceInit-5) (NonceRecv NonceRecv-5)
    (initiator initiator) (responder initiator-4)
    (certificateAuthority certificateAuthority))
  (precedes ((0 2) (6 2)) ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2))
    ((4 3) (3 2)) ((5 3) (4 2)) ((6 3) (5 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (displaced 7 0 initiator 3)
    (enc (hash initiator-5 (pubk initiator-5))
      (privk certificateAuthority)) (6 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator-4) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator-4)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-4)
              (pubk initiator-3))))))
    ((recv (cat IKEheader-5 SAi1-5 (pubk initiator) NonceInit-5))
      (send
        (cat IKEheader-5 SAr1-5 (pubk initiator-4) NonceRecv-5
          certificateAuthority))
      (recv
        (cat IKEheader-5
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            initiator-4 (hash NonceInit-5 initiator-4) SAi2-5 TSi-5
            TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-4)
              (pubk initiator)))))
      (send
        (cat IKEheader-5
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority)))
            (hash NonceInit-5 initiator-4) SAr2-5 TSi-5 TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator)
              (pubk initiator-4)))))))
  (label 19)
  (parent 18)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 IKEheader-5 SAi1-5 SAr1-5
      SAi2-5 SAr2-5 TSi-5 TSr-5 IKEheader-6 SAi1-6 SAr1-6 SAi2-6 TSi-6
      TSr-6 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 NonceInit-5 NonceRecv-5 NonceInit-6 NonceRecv-6 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 initiator-4 initiator-5 responder-0 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-4) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-5) (SAi1 SAi1-5)
    (SAr1 SAr1-5) (SAi2 SAi2-5) (SAr2 SAr2-5) (TSi TSi-5) (TSr TSr-5)
    (NonceInit NonceInit-5) (NonceRecv NonceRecv-5)
    (initiator initiator-5) (responder initiator-4)
    (certificateAuthority certificateAuthority))
  (defstrand initiator 3 (IKEheader IKEheader-6) (SAi1 SAi1-6)
    (SAr1 SAr1-6) (SAi2 SAi2-6) (TSi TSi-6) (TSr TSr-6)
    (NonceInit NonceInit-6) (NonceRecv NonceRecv-6)
    (initiator initiator-5) (responder responder-0)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2))
    ((5 3) (4 2)) ((6 3) (5 2)) ((7 2) (6 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand initiator 3)
    (enc (hash initiator-5 (pubk initiator-5))
      (privk certificateAuthority)) (6 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator-4) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator-4)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-4)
              (pubk initiator-3))))))
    ((recv (cat IKEheader-5 SAi1-5 (pubk initiator-5) NonceInit-5))
      (send
        (cat IKEheader-5 SAr1-5 (pubk initiator-4) NonceRecv-5
          certificateAuthority))
      (recv
        (cat IKEheader-5
          (enc initiator-5
            (cat initiator-5 (pubk initiator-5)
              (enc (hash initiator-5 (pubk initiator-5))
                (privk certificateAuthority))) certificateAuthority
            initiator-4 (hash NonceInit-5 initiator-4) SAi2-5 TSi-5
            TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-4)
              (pubk initiator-5)))))
      (send
        (cat IKEheader-5
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority)))
            (hash NonceInit-5 initiator-4) SAr2-5 TSi-5 TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-5)
              (pubk initiator-4))))))
    ((send (cat IKEheader-6 SAi1-6 (pubk initiator-5) NonceInit-6))
      (recv
        (cat IKEheader-6 SAr1-6 (pubk responder-0) NonceRecv-6
          certificateAuthority))
      (send
        (cat IKEheader-6
          (enc initiator-5
            (cat initiator-5 (pubk initiator-5)
              (enc (hash initiator-5 (pubk initiator-5))
                (privk certificateAuthority))) certificateAuthority
            responder-0 (hash NonceRecv-6 initiator-5) SAi2-6 TSi-6
            TSr-6
            (hash NonceInit-6 NonceRecv-6 (pubk responder-0)
              (pubk initiator-5)))))))
  (label 20)
  (parent 18)
  (realized)
  (shape)
  (maps
    ((0)
      ((initiator initiator) (responder responder)
        (certificateAuthority certificateAuthority)
        (NonceInit NonceInit) (IKEheader IKEheader) (SAi1 SAi1)
        (SAr1 SAr1) (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr)
        (NonceRecv NonceRecv))))
  (origs (NonceInit (0 0))))

(comment "Strand bound exceeded--aborting run")

(defskeleton ikev2
  (vars
    (IKEheader SAi1 SAr1 SAi2 SAr2 TSi TSr IKEheader-0 SAi1-0 SAr1-0
      SAi2-0 SAr2-0 TSi-0 TSr-0 IKEheader-1 SAi1-1 SAr1-1 SAi2-1 SAr2-1
      TSi-1 TSr-1 IKEheader-2 SAi1-2 SAr1-2 SAi2-2 SAr2-2 TSi-2 TSr-2
      IKEheader-3 SAi1-3 SAr1-3 SAi2-3 SAr2-3 TSi-3 TSr-3 IKEheader-4
      SAi1-4 SAr1-4 SAi2-4 SAr2-4 TSi-4 TSr-4 IKEheader-5 SAi1-5 SAr1-5
      SAi2-5 SAr2-5 TSi-5 TSr-5 IKEheader-6 SAi1-6 SAr1-6 SAi2-6 SAr2-6
      TSi-6 TSr-6 data)
    (NonceInit NonceRecv NonceInit-0 NonceRecv-0 NonceInit-1 NonceRecv-1
      NonceInit-2 NonceRecv-2 NonceInit-3 NonceRecv-3 NonceInit-4
      NonceRecv-4 NonceInit-5 NonceRecv-5 NonceInit-6 NonceRecv-6 text)
    (initiator responder certificateAuthority initiator-0 initiator-1
      initiator-2 initiator-3 initiator-4 initiator-5 initiator-6 name))
  (defstrand initiator 4 (IKEheader IKEheader) (SAi1 SAi1) (SAr1 SAr1)
    (SAi2 SAi2) (SAr2 SAr2) (TSi TSi) (TSr TSr) (NonceInit NonceInit)
    (NonceRecv NonceRecv) (initiator initiator) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-0) (SAi1 SAi1-0)
    (SAr1 SAr1-0) (SAi2 SAi2-0) (SAr2 SAr2-0) (TSi TSi-0) (TSr TSr-0)
    (NonceInit NonceInit-0) (NonceRecv NonceRecv-0)
    (initiator initiator-0) (responder responder)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-1) (SAi1 SAi1-1)
    (SAr1 SAr1-1) (SAi2 SAi2-1) (SAr2 SAr2-1) (TSi TSi-1) (TSr TSr-1)
    (NonceInit NonceInit-1) (NonceRecv NonceRecv-1)
    (initiator initiator-1) (responder initiator-0)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-2) (SAi1 SAi1-2)
    (SAr1 SAr1-2) (SAi2 SAi2-2) (SAr2 SAr2-2) (TSi TSi-2) (TSr TSr-2)
    (NonceInit NonceInit-2) (NonceRecv NonceRecv-2)
    (initiator initiator-2) (responder initiator-1)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-3) (SAi1 SAi1-3)
    (SAr1 SAr1-3) (SAi2 SAi2-3) (SAr2 SAr2-3) (TSi TSi-3) (TSr TSr-3)
    (NonceInit NonceInit-3) (NonceRecv NonceRecv-3)
    (initiator initiator-3) (responder initiator-2)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-4) (SAi1 SAi1-4)
    (SAr1 SAr1-4) (SAi2 SAi2-4) (SAr2 SAr2-4) (TSi TSi-4) (TSr TSr-4)
    (NonceInit NonceInit-4) (NonceRecv NonceRecv-4)
    (initiator initiator-4) (responder initiator-3)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-5) (SAi1 SAi1-5)
    (SAr1 SAr1-5) (SAi2 SAi2-5) (SAr2 SAr2-5) (TSi TSi-5) (TSr TSr-5)
    (NonceInit NonceInit-5) (NonceRecv NonceRecv-5)
    (initiator initiator-5) (responder initiator-4)
    (certificateAuthority certificateAuthority))
  (defstrand responder 4 (IKEheader IKEheader-6) (SAi1 SAi1-6)
    (SAr1 SAr1-6) (SAi2 SAi2-6) (SAr2 SAr2-6) (TSi TSi-6) (TSr TSr-6)
    (NonceInit NonceInit-6) (NonceRecv NonceRecv-6)
    (initiator initiator-6) (responder initiator-5)
    (certificateAuthority certificateAuthority))
  (precedes ((1 3) (0 3)) ((2 3) (1 2)) ((3 3) (2 2)) ((4 3) (3 2))
    ((5 3) (4 2)) ((6 3) (5 2)) ((7 3) (6 2)))
  (non-orig (privk certificateAuthority))
  (uniq-orig NonceInit)
  (operation encryption-test (added-strand responder 4)
    (enc (hash initiator-5 (pubk initiator-5))
      (privk certificateAuthority)) (6 2))
  (traces
    ((send (cat IKEheader SAi1 (pubk initiator) NonceInit))
      (recv
        (cat IKEheader SAr1 (pubk responder) NonceRecv
          certificateAuthority))
      (send
        (cat IKEheader
          (enc initiator
            (cat initiator (pubk initiator)
              (enc (hash initiator (pubk initiator))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceRecv initiator) SAi2 TSi TSr
            (hash NonceInit NonceRecv (pubk responder)
              (pubk initiator)))))
      (recv
        (cat IKEheader
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceRecv initiator) SAr2 TSi TSr
            (hash NonceInit NonceRecv (pubk initiator)
              (pubk responder))))))
    ((recv (cat IKEheader-0 SAi1-0 (pubk initiator-0) NonceInit-0))
      (send
        (cat IKEheader-0 SAr1-0 (pubk responder) NonceRecv-0
          certificateAuthority))
      (recv
        (cat IKEheader-0
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority))) certificateAuthority
            responder (hash NonceInit-0 responder) SAi2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk responder)
              (pubk initiator-0)))))
      (send
        (cat IKEheader-0
          (enc responder
            (cat responder (pubk responder)
              (enc (hash responder (pubk responder))
                (privk certificateAuthority)))
            (hash NonceInit-0 responder) SAr2-0 TSi-0 TSr-0
            (hash NonceInit-0 NonceRecv-0 (pubk initiator-0)
              (pubk responder))))))
    ((recv (cat IKEheader-1 SAi1-1 (pubk initiator-1) NonceInit-1))
      (send
        (cat IKEheader-1 SAr1-1 (pubk initiator-0) NonceRecv-1
          certificateAuthority))
      (recv
        (cat IKEheader-1
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority))) certificateAuthority
            initiator-0 (hash NonceInit-1 initiator-0) SAi2-1 TSi-1
            TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-0)
              (pubk initiator-1)))))
      (send
        (cat IKEheader-1
          (enc initiator-0
            (cat initiator-0 (pubk initiator-0)
              (enc (hash initiator-0 (pubk initiator-0))
                (privk certificateAuthority)))
            (hash NonceInit-1 initiator-0) SAr2-1 TSi-1 TSr-1
            (hash NonceInit-1 NonceRecv-1 (pubk initiator-1)
              (pubk initiator-0))))))
    ((recv (cat IKEheader-2 SAi1-2 (pubk initiator-2) NonceInit-2))
      (send
        (cat IKEheader-2 SAr1-2 (pubk initiator-1) NonceRecv-2
          certificateAuthority))
      (recv
        (cat IKEheader-2
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority))) certificateAuthority
            initiator-1 (hash NonceInit-2 initiator-1) SAi2-2 TSi-2
            TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-1)
              (pubk initiator-2)))))
      (send
        (cat IKEheader-2
          (enc initiator-1
            (cat initiator-1 (pubk initiator-1)
              (enc (hash initiator-1 (pubk initiator-1))
                (privk certificateAuthority)))
            (hash NonceInit-2 initiator-1) SAr2-2 TSi-2 TSr-2
            (hash NonceInit-2 NonceRecv-2 (pubk initiator-2)
              (pubk initiator-1))))))
    ((recv (cat IKEheader-3 SAi1-3 (pubk initiator-3) NonceInit-3))
      (send
        (cat IKEheader-3 SAr1-3 (pubk initiator-2) NonceRecv-3
          certificateAuthority))
      (recv
        (cat IKEheader-3
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority))) certificateAuthority
            initiator-2 (hash NonceInit-3 initiator-2) SAi2-3 TSi-3
            TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-2)
              (pubk initiator-3)))))
      (send
        (cat IKEheader-3
          (enc initiator-2
            (cat initiator-2 (pubk initiator-2)
              (enc (hash initiator-2 (pubk initiator-2))
                (privk certificateAuthority)))
            (hash NonceInit-3 initiator-2) SAr2-3 TSi-3 TSr-3
            (hash NonceInit-3 NonceRecv-3 (pubk initiator-3)
              (pubk initiator-2))))))
    ((recv (cat IKEheader-4 SAi1-4 (pubk initiator-4) NonceInit-4))
      (send
        (cat IKEheader-4 SAr1-4 (pubk initiator-3) NonceRecv-4
          certificateAuthority))
      (recv
        (cat IKEheader-4
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority))) certificateAuthority
            initiator-3 (hash NonceInit-4 initiator-3) SAi2-4 TSi-4
            TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-3)
              (pubk initiator-4)))))
      (send
        (cat IKEheader-4
          (enc initiator-3
            (cat initiator-3 (pubk initiator-3)
              (enc (hash initiator-3 (pubk initiator-3))
                (privk certificateAuthority)))
            (hash NonceInit-4 initiator-3) SAr2-4 TSi-4 TSr-4
            (hash NonceInit-4 NonceRecv-4 (pubk initiator-4)
              (pubk initiator-3))))))
    ((recv (cat IKEheader-5 SAi1-5 (pubk initiator-5) NonceInit-5))
      (send
        (cat IKEheader-5 SAr1-5 (pubk initiator-4) NonceRecv-5
          certificateAuthority))
      (recv
        (cat IKEheader-5
          (enc initiator-5
            (cat initiator-5 (pubk initiator-5)
              (enc (hash initiator-5 (pubk initiator-5))
                (privk certificateAuthority))) certificateAuthority
            initiator-4 (hash NonceInit-5 initiator-4) SAi2-5 TSi-5
            TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-4)
              (pubk initiator-5)))))
      (send
        (cat IKEheader-5
          (enc initiator-4
            (cat initiator-4 (pubk initiator-4)
              (enc (hash initiator-4 (pubk initiator-4))
                (privk certificateAuthority)))
            (hash NonceInit-5 initiator-4) SAr2-5 TSi-5 TSr-5
            (hash NonceInit-5 NonceRecv-5 (pubk initiator-5)
              (pubk initiator-4))))))
    ((recv (cat IKEheader-6 SAi1-6 (pubk initiator-6) NonceInit-6))
      (send
        (cat IKEheader-6 SAr1-6 (pubk initiator-5) NonceRecv-6
          certificateAuthority))
      (recv
        (cat IKEheader-6
          (enc initiator-6
            (cat initiator-6 (pubk initiator-6)
              (enc (hash initiator-6 (pubk initiator-6))
                (privk certificateAuthority))) certificateAuthority
            initiator-5 (hash NonceInit-6 initiator-5) SAi2-6 TSi-6
            TSr-6
            (hash NonceInit-6 NonceRecv-6 (pubk initiator-5)
              (pubk initiator-6)))))
      (send
        (cat IKEheader-6
          (enc initiator-5
            (cat initiator-5 (pubk initiator-5)
              (enc (hash initiator-5 (pubk initiator-5))
                (privk certificateAuthority)))
            (hash NonceInit-6 initiator-5) SAr2-6 TSi-6 TSr-6
            (hash NonceInit-6 NonceRecv-6 (pubk initiator-6)
              (pubk initiator-5)))))))
  (label 21)
  (parent 18)
  (unrealized (7 2))
  (aborted)
  (comment "aborted"))
